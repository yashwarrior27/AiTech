$(document).ready((function(){const{ethereum:e}=window,r=window.location.origin,t="/login";var a=null;function l(e){return new libphonenumber.parsePhoneNumber(e).isValid()}$(".login-page").on("click",(()=>setTimeout((()=>{window.location.replace(r+t)}),1e3))),$(".register-page").on("click",(()=>window.location.replace(r+"/register"))),$("#login").on("click",(async t=>{let l=$("#login");return l.attr("disabled",!0),e?(await e.enable().then((e=>a=e[0].toLowerCase())).catch((e=>{l.attr("disabled",!1),4001==e.code&&toastr.error("Login has been cancelled.","Failed"),-32002==e.code&&toastr.info("Please connect to Wallet.","Already open")})),a?$.post({url:r+"/api/login",data:{walletAddress:a}}).then((e=>{if(e.success)return toastr.success(e.message),localStorage.setItem("address",a.toLowerCase()),setTimeout((()=>{window.location.replace(r+"/dashboard")}),1e3)})).catch((e=>{toastr.error(e.responseJSON.message),setTimeout((()=>location.reload()),1e3)})):(l.attr("disabled",!1),!1)):(l.attr("disabled",!1),toastr.error("Please add Wallet first.","Add Wallet"))})),$("#phone").on("keyup keypress blur change",(function(){let e=$(this).val(),[r,t]=$("#country_code").val().split("-");return e.length<3&&e.length>12?$("#phone-err").html("Invalid mobile number."):l("+"+t+e)?$("#phone-err").html(""):$("#phone-err").html("Invalid mobile number.")})),$("#referral_no").on("keyup keypress blur change",(async function(){let e=$("#referral_no").val();if($("#referral-err").html(""),!e)return $("#referral-err").html("Please enter the referral code.");let r=null;return await o(e).catch((e=>r=e.responseJSON.message)),r?$("#referral-err").html(r):void 0})),$("#register").on("submit",(async n=>{n.preventDefault();let s=$("#register").serializeArray(),i={};for(let e of s){if(!e.value&&"phone"==e.name)return $("#phone-err").html("Please enter mobile number");if(!e.value&&"referral_code"==e.name)return $("#referral-err").html("Please enter the referral code.");i[e.name]=e.value}let[c,d]=i.country_code.split("-");if(i.country_code=c,i.phone.length<3&&i.phone.length>12)return $("#phone-err").html("Invalid mobile number.");if(!l("+"+d+i.phone))return $("#phone-err").html("Invalid mobile number.");if($("#phone-err").html(""),!i.referral_code)return $("#referral-err").html("Please enter the referral code.");if(i.referral_code){let e=null;if(await o(i.referral_code).catch((r=>e=r.responseJSON.message)),e)return $("#referral-err").html(e)}return $("#referral-err").html(""),e?(await e.enable().then((e=>a=e[0].toLowerCase())).catch((e=>{4001==e.code&&toastr.error("Register has been cancelled.","Failed"),-32002==e.code&&toastr.info("Please connect to Wallet.","Already open")})),!!a&&void $.post({url:r+"/api/register",data:{walletAddress:a,...i}}).then((e=>{if(e.success)return toastr.success(e.message),setTimeout((()=>{window.location.href=r+t}),700)})).catch((e=>toastr.error(e.responseJSON.message)))):(toastr.error("Please add Wallet first.","Add Wallet"),!1)}));const o=async e=>await $.post({url:r+"/api/check-referral-no",data:{referral_code:e}});$.get(r+"/api/logout").then((e=>{e.success&&localStorage.clear()})).catch((e=>toastr.error(e.message)))}));